!function(){"use strict";var e=window.wp.element,t=window.lodash,s=window.wp.i18n,n=window.wp.blocks,o=window.wp.blockEditor,l=window.wp.components,r=window.wp.compose,c=window.wp.hooks;let i=null;window.otterCSSLintIgnored=[];var a=(0,e.memo)((t=>{let{attributes:n,setAttributes:o,clientId:r}=t;const c=(0,e.useRef)(null),[a,u]=(0,e.useState)([]),[m,d]=(0,e.useState)(null),p=()=>{const e=r.substring(0,8);if(m?.replace(/\s+/g,"")==="selector {\n}\n".replace(/\s+/g,""))return n.className;const{className:t}=n;return t?t.includes("ticss-")?t:[...t.trim().split(" "),`ticss-${e}`].join(" "):`ticss-${e}`},w=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=e?.state?.lint?.marked?.filter((e=>{let{__annotation:t}=e;return"error"===t?.severity}))?.map((e=>{let{__annotation:t}=e;return t?.message}));t&&0<s?.length&&(window.otterCSSLintIgnored=s),s=s?.filter((e=>!window.otterCSSLintIgnored.includes(e))),u(s),!t&&0<s?.length||d(e?.getValue())};return(0,e.useEffect)((()=>{const e=n.customCSS&&n.className?.includes("ticss-")?n.className.split(" ").find((e=>e.includes("ticss"))):null;let t="selector {\n}\n";if(n.customCSS){const s=new RegExp("."+e,"g");t=n.customCSS.replace(s,"selector")}c.current=wp.CodeMirror(document.getElementById("o-css-editor"),{value:t,autoCloseBrackets:!0,continueComments:!0,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,lint:!0,gutters:["CodeMirror-lint-markers"],styleActiveLine:!0,styleActiveSelected:!0,mode:"css",extraKeys:{"Ctrl-Space":"autocomplete","Alt-F":"findPersistent","Cmd-F":"findPersistent"}});const s=()=>{clearTimeout(i),i=setTimeout((()=>{w(c.current)}),500)};return c.current.on("change",s),()=>{c.current.off("change",s)}}),[]),(0,e.useEffect)((()=>{const e=new RegExp("selector","g"),t=p(),s=t?m?.replace(e,`.${t.split(" ").find((e=>e.includes("ticss")))}`):m;"selector {\n}\n".replace(/\s+/g,"")!==s?.replace(/\s+/g,"")?s&&o({customCSS:s,hasCustomCSS:!0,className:p()}):o({customCSS:null})}),[m]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,s.__)("Add your custom CSS.","blocks-css")),(0,e.createElement)("div",{id:"o-css-editor",className:"o-css-editor"}),0<a?.length&&(0,e.createElement)("div",{className:"o-css-errors"},(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},(0,s.__)("Attention needed! We found following errors with your code:","blocks-css")),(0,e.createElement)("pre",null,(0,e.createElement)("ul",null,a.map(((t,s)=>(0,e.createElement)("li",{key:s},t))))),(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>w(c.current,!0),style:{width:"max-content",marginBottom:"20px"}},(0,s.__)("Override","blocks-css"))),(0,e.createElement)("p",null,(0,s.__)("Use","blocks-css")," ",(0,e.createElement)("code",null,"selector")," ",(0,s.__)("to target block wrapper.","blocks-css")),(0,e.createElement)("br",null),(0,e.createElement)("p",null,(0,s.__)("Example:","blocks-css")),(0,e.createElement)("pre",{className:"o-css-editor-help"},"selector {\n    background: #000;\n}\n\nselector img {\n    border-radius: 100%;\n}"),(0,e.createElement)("p",null,(0,s.__)("You can also use other CSS syntax here, such as media queries.","blocks-css")))})),u=window.wp.data;let m=!0;const d=e=>{const t=window.parent.document.querySelector('iframe[name="editor-canvas"]')?.contentWindow;let s=t?.document.head||document.head,n=s.querySelector("#o-css-editor-styles");return m&&t?(t.addEventListener("DOMContentLoaded",(function(){setTimeout((()=>{d(e)}),500)})),void(m=!1)):(null===n&&(n=document.createElement("style"),n.setAttribute("type","text/css"),n.setAttribute("id","o-css-editor-styles"),s?.appendChild(n)),n.textContent===e?null:n.textContent=e)},p=(e,s)=>{if(!e)return"";const o=e=>{const t=[];if("core/block"===e.name&&null!==s){const l=s.find((t=>e.attributes.ref===t.id));if(l&&l.content){const e=l.content.hasOwnProperty("raw")?l.content.raw:l.content;t.push((0,n.parse)(e).map((e=>[e,o(e)])))}}return void 0!==e.innerBlocks&&0<e.innerBlocks.length&&t.push(e.innerBlocks.map((e=>[e,o(e)]))),t},l=e.map((e=>[e,o(e)]));return(0,t.flattenDeep)(l).map((e=>e.attributes&&e.attributes.hasCustomCSS&&e.attributes.customCSS&&null!==e.attributes.customCSS?e.attributes.customCSS+"\n":"")).reduce(((e,t)=>e+t),"")};let w=[],S=!1;(0,u.subscribe)((()=>{const{getBlocks:e}=(0,u.select)("core/block-editor"),s=!!(0,u.select)("core/edit-post")&&(0,u.select)("core/edit-post").__experimentalGetPreviewDeviceType(),n=e(),o=(0,u.select)("core").getEntityRecords("postType","wp_block",{context:"view"});if(!(0,t.isEqual)(w,n)||S!==s){const e=p(n,o);e&&(S!==s&&"Desktop"===S?setTimeout((()=>{d(e)}),500):d(e)),w=n,S=s}}));const b=t=>{let{clientId:n,setAttributes:o,attributes:r}=t;return(0,e.createElement)(l.PanelBody,{title:(0,s.__)("Custom CSS","blocks-css"),initialOpen:!1},(0,e.createElement)(a,{clientId:n,setAttributes:o,attributes:r}),(0,e.createElement)("div",{className:"o-fp-wrap"},(0,c.applyFilters)("otter.feedback","","custom-css"),(0,c.applyFilters)("otter.poweredBy","")))},C=(0,r.createHigherOrderComponent)((t=>s=>(0,n.hasBlockSupport)(s.name,"customClassName",!0)&&s.isSelected?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t,s),(0,e.createElement)(o.InspectorControls,null,(0,e.createElement)(b,s))):(0,e.createElement)(t,s)),"withInspectorControl");(0,c.addFilter)("blocks.registerBlockType","themeisle-custom-css/attribute",(e=>((0,n.hasBlockSupport)(e,"customClassName",!0)&&(e.attributes=(0,t.assign)(e.attributes,{hasCustomCSS:{type:"boolean",default:!1},customCSS:{type:"string",default:null}})),e))),Boolean(window?.blocksCSS?.hasOtter)?(0,c.addFilter)("otter.blockTools","themeisle-custom-css/with-inspector-controls",((t,o)=>(0,n.hasBlockSupport)(o.name,"customClassName",!0)?(0,e.createElement)(e.Fragment,null,t,(0,e.createElement)(l.__experimentalToolsPanelItem,{hasValue:()=>Boolean(o.attributes?.hasCustomCSS),label:(0,s.__)("Custom CSS","blocks-css"),onDeselect:()=>{o.setAttributes({hasCustomCSS:!1,customCSS:null}),(()=>{const{getBlocks:e}=(0,u.select)("core/block-editor"),t=e(),s=(0,u.select)("core").getEntityRecords("postType","wp_block",{context:"view"}),n=p(t,s);d(n)})()},isShownByDefault:!1},(0,e.createElement)(b,o))):t),2):(0,c.addFilter)("editor.BlockEdit","themeisle-custom-css/with-inspector-controls",C)}();